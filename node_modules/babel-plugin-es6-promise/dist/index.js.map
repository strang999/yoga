{"version":3,"sources":["../src/index.js"],"names":["visitor","Program","path","name","scope","generateUid","used","traverse","replaceIdentifier","getReplacement","t","identifier","unshiftContainer","buildPolyfill","PROMISE","ReferencedIdentifier","node","getBindingIdentifier","replaceWith"],"mappings":";;;;;;kBAoBe,YAAY;AACzB,SAAO;AACLA,aAAS;AACPC,aADO,YACEC,IADF,EACQ;AACb,YAAMC,OAAOD,KAAKE,KAAL,CAAWC,WAAX,CAAuB,SAAvB,CAAb;;AAEA,YAAIC,OAAO,KAAX;AACAJ,aAAKK,QAAL,CAAcC,iBAAd,EAAiC;AAC/BC,wBAD+B,cACb;AAChBH,mBAAO,IAAP;AACA,mBAAOI,EAAEC,UAAF,CAAaR,IAAb,CAAP;AACD;AAJ8B,SAAjC;;AAOA,YAAIG,IAAJ,EAAU;AACRJ,eAAKU,gBAAL,CAAsB,MAAtB,EAA8BC,cAAc;AAC1CC,qBAASJ,EAAEC,UAAF,CAAaR,IAAb;AADiC,WAAd,CAA9B;AAGD;AACF;AAjBM;AADJ,GAAP;AAqBD,C;;AA1CD;;;;AACA;;IAAYO,C;;;;;;AAEZ,IAAMG,gBAAgB,2IAAtB;;AAMA,IAAML,oBAAoB;AACxBO,sBADwB,YACFb,IADE,EACI;AAAA,QAClBc,IADkB,GACFd,IADE,CAClBc,IADkB;AAAA,QACZZ,KADY,GACFF,IADE,CACZE,KADY;;;AAG1B,QAAIY,KAAKb,IAAL,KAAc,SAAlB,EAA6B;AAC7B,QAAIC,MAAMa,oBAAN,CAA2BD,KAAKb,IAAhC,CAAJ,EAA2C;;AAE3CD,SAAKgB,WAAL,CAAiB,KAAKT,cAAL,EAAjB;AACD;AARuB,CAA1B","file":"index.js","sourcesContent":["import template from 'babel-template'\nimport * as t from 'babel-types'\n\nconst buildPolyfill = template(`\n  var PROMISE = typeof Promise === 'undefined'\n    ? require('es6-promise').Promise\n    : Promise\n`)\n\nconst replaceIdentifier = {\n  ReferencedIdentifier (path) {\n    const { node, scope } = path\n\n    if (node.name !== 'Promise') return\n    if (scope.getBindingIdentifier(node.name)) return\n\n    path.replaceWith(this.getReplacement())\n  }\n}\n\nexport default function () {\n  return {\n    visitor: {\n      Program (path) {\n        const name = path.scope.generateUid('Promise')\n\n        let used = false\n        path.traverse(replaceIdentifier, {\n          getReplacement () {\n            used = true\n            return t.identifier(name)\n          }\n        })\n\n        if (used) {\n          path.unshiftContainer('body', buildPolyfill({\n            PROMISE: t.identifier(name)\n          }))\n        }\n      }\n    }\n  }\n}\n"]}